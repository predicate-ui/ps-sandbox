echo "Installing Odoo 14 on Ubuntu 20.04 LTS"

echo "Updating Server"
sudo apt-get update
sudo apt-get upgrade -y

echo "Creating Odoo User"
sudo adduser -system -home=/opt/odoo -group odoo

echo "Installing PostreSQL Server"
sudo apt-get install postgresql -y

echo "Creating Odoo user for PostgreSQL"
sudo su - postgres -c "createuser -s odoo" 2> /dev/null || true

echo "Installing Python Dependencies"
sudo apt-get install git python3 python3-pip build-essential wget python3-dev python3-venv python3-wheel libxslt-dev libzip-dev libldap2-dev libsasl2-dev python3-setuptools node-less libjpeg-dev gdebi -y

echo "Installing pip Dependencies"
sudo apt-get install libpq-dev python-dev libxml2-dev libxslt1-dev libldap2-dev libsasl2-dev libffi-dev -y
sudo -H pip3 install -r https://raw.githubusercontent.com/odoo/odoo/master/requirements.txt -y

echo "Installing other req packages"
sudo apt-get install nodejs npm -y
sudo npm install -g rtlcss

echo "Installing wkhtmltopdf"
sudo apt-get install xfonts-75dpi
sudo wget https://github.com/wkhtmltopdf/packaging/releases/download/0.12.6-1/wkhtmltox_0.12.6-1.bionic_amd64.deb
sudo dpkg -i wkhtmltox_0.12.6-1.bionic_amd64.deb
sudo cp /usr/local/bin/wkhtmltoimage /usr/bin/wkhtmltoimage
sudo cp /usr/local/bin/wkhtmltopdf /usr/bin/wkhtmltopdf

echo "Creating Log Dir"
sudo mkdir /var/log/odoo
sudo chown odoo:odoo /var/log/odoo

echo "Installing Odoo"
sudo apt-get install git
sudo git clone --depth 1 --branch master https://www.github.com/odoo/odoo /odoo/odoo-server

echo "Setting permissions on home folder"
sudo chown -R odoo:odoo /odoo/*

echo "Creating server config file"
sudo touch /etc/odoo-server.conf
sudo su root -c "printf '[options] \n; This is the password that allows database operations:\n' >> /etc/odoo-server.conf" 
sudo su root -c "printf 'admin_passwd = admin\n' >> /etc/odoo-server.conf"
sudo su root -c "printf 'xmlrpc_port = 8069\n' >> /etc/odoo-server.conf" 
sudo su root -c "printf 'logfile = /var/log/odoo/odoo-server.log\n' >> /etc/odoo-server.conf" 
sudo su root -c "printf 'addons_path=/odoo/odoo-server/addons\n' >> /etc/odoo-server.conf" 
sudo chown odoo:odoo /etc/odoo-server.conf 
sudo chmod 640 /etc/odoo-server.conf 

echo "Writing alias for 'odoo_start'"
echo $'alias odoo_start=\'
echo "Launching your odoo instance."
echo "Go to web browser and access your odoo at:"
echo -e "     \e]8;;localhost:8069\alocalhost:8069\e]8;;\a"
sudo su - odoo -s /bin/bash -c "
cd /odoo/odoo-server
./odoo-bin -c /etc/odoo-server.conf"\'' >> .bash_aliases && source .bash_aliases

echo "Starting Odoo"
odoo_start